#!/usr/bin/env bash

set -e

brew_flags=""

brew_cmd() {
  /usr/local/bin/brew $@
}

if [[ "$1" == "-v" || "$1" == "--verbose" ]] ; then
  brew_flags="--verbose"
fi

# Don't update when on battery power
if pmset -g batt | head -1 | grep -q "AC Power" ; then

  # Update sources
  brew_cmd update $brew_flags

  # Upgrade neovim
  brew_cmd reinstall --HEAD neovim neovim-dot-app fzf && \
  brew_cmd linkapps neovim neovim-dot-app

  # Upgrade everything else
  brew_cmd upgrade --all --cleanup

  # Cleanup
  brew_cmd cleanup
  brew_cmd cask cleanup

fi
